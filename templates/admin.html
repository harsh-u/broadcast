<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Roboto, Arial; max-width: 900px; margin: 20px auto; }
    h1 { margin-bottom: 12px; }
    .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    a.btn { padding: 8px 12px; border-radius: 8px; background: #667eea; color: white; text-decoration: none; }
    .section { margin-top: 24px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    th { background: #f8f9fa; }
    form { display: inline; }
    button.approve { background: #28a745; color: white; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; }
    .muted { color: #666; }
    .flash { padding: 10px; margin-bottom: 12px; border-radius: 6px; }
    .flash-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .flash-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Admin Dashboard</h1>
    <div>
      <span class="muted">Logged in as <strong>{{ current_user.username }}</strong></span>
      <a class="btn" href="{{ url_for('index') }}" style="margin-left:10px;">Go to App</a>
      <a class="btn" href="{{ url_for('logout') }}" style="margin-left:10px;background:#dc3545;">Logout</a>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <div class="section">
    <h2>Pending Approvals</h2>
    {% if pending_users %}
      <table>
        <thead>
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in pending_users %}
            <tr>
              <td>{{ u.username }}</td>
              <td>{{ u.email }}</td>
              <td>
                <form method="POST" action="{{ url_for('approve_user', user_id=u.id) }}">
                  <button class="approve" type="submit">Approve</button>
                </form>
                <form method="POST" action="{{ url_for('reject_user', user_id=u.id) }}" style="display:inline;margin-left:8px;">
                  <button class="approve" type="submit" style="background:#dc3545;">Reject</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No pending users.</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>Approved Users</h2>
    {% if approved_users %}
      <table>
        <thead>
          <tr>
            <th>Username</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
          {% for u in approved_users %}
            <tr>
              <td>{{ u.username }}{% if u.is_admin %} (admin){% endif %}</td>
              <td>{{ u.email }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="muted">No approved users yet.</p>
    {% endif %}
  </div>
</body>
</html>
